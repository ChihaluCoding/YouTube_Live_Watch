<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube ãƒãƒ«ãƒãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .api-setup {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 2px solid #e0e0e0;
        }

        .api-setup h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-group input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .channel-list {
            margin-bottom: 20px;
        }

        .channel-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .channel-item:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateX(5px);
        }

        .channel-info {
            flex: 1;
        }

        .channel-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .channel-id {
            font-size: 12px;
            color: #666;
            font-family: monospace;
        }

        .status {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 10px;
        }

        .status.live {
            background: #ff4757;
            color: white;
        }

        .status.offline {
            background: #ddd;
            color: #666;
        }

        .grid-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .grid-controls label {
            font-weight: 600;
            color: #333;
        }

        .grid-controls select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
        }

        .streams-grid {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .grid-1x1 { grid-template-columns: 1fr; }
        .grid-2x2 { grid-template-columns: 1fr 1fr; }
        .grid-3x3 { grid-template-columns: repeat(3, 1fr); }
        .grid-2x3 { grid-template-columns: 1fr 1fr; grid-template-rows: repeat(3, 300px); }

        .stream-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .stream-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .stream-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stream-title {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .stream-frame {
            width: 100%;
            height: 300px;
            border: none;
            border-radius: 12px;
            background: #f0f0f0;
        }

        .no-stream {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            color: #666;
            font-style: italic;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #667eea;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #ff4757;
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            text-align: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .grid-2x2, .grid-3x3, .grid-2x3 {
                grid-template-columns: 1fr;
            }
            
            .grid-controls {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ YouTube ãƒãƒ«ãƒãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼</h1>
            <p>è¤‡æ•°ã®YouTubeãƒ©ã‚¤ãƒ–é…ä¿¡ã‚’åŒæ™‚ã«è¦–è´ã§ãã¾ã™</p>
        </div>

        <div class="controls">
            <div class="api-setup">
                <h3>ğŸ“‹ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</h3>
                <div class="input-group">
                    <input type="text" id="apiKey" placeholder="YouTube Data API v3 ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                    <button class="btn" onclick="saveApiKey()">APIã‚­ãƒ¼ä¿å­˜</button>
                </div>
                <p style="font-size: 12px; color: #666; margin-top: 10px;">
                    â€» Google Cloud Consoleã§YouTube Data API v3ã‚’æœ‰åŠ¹ã«ã—ã¦APIã‚­ãƒ¼ã‚’å–å¾—ã—ã¦ãã ã•ã„
                </p>
            </div>

            <h3>ğŸ“º ãƒãƒ£ãƒ³ãƒãƒ«ç®¡ç†</h3>
            <div class="input-group">
                <input type="text" id="channelInput" placeholder="ãƒãƒ£ãƒ³ãƒãƒ«IDã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›">
                <button class="btn" onclick="addChannel()">ãƒãƒ£ãƒ³ãƒãƒ«è¿½åŠ </button>
            </div>

            <div class="channel-list" id="channelList"></div>

            <div class="grid-controls">
                <label for="gridLayout">è¡¨ç¤ºãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ:</label>
                <select id="gridLayout" onchange="updateLayout()">
                    <option value="grid-1x1">1ç”»é¢</option>
                    <option value="grid-2x2" selected>2Ã—2</option>
                    <option value="grid-3x3">3Ã—3</option>
                    <option value="grid-2x3">2Ã—3</option>
                </select>
                <button class="btn" onclick="refreshAllStreams()">ğŸ”„ å…¨ã¦æ›´æ–°</button>
            </div>
        </div>

        <div class="streams-grid grid-2x2" id="streamsGrid"></div>
    </div>

    <script>
        let apiKey = localStorage.getItem('youtube-api-key') || '';
        let channels = JSON.parse(localStorage.getItem('youtube-channels') || '[]');
        let liveStreams = {};

        // åˆæœŸåŒ–
        document.getElementById('apiKey').value = apiKey;
        loadChannels();
        refreshAllStreams();

        function saveApiKey() {
            apiKey = document.getElementById('apiKey').value.trim();
            if (apiKey) {
                localStorage.setItem('youtube-api-key', apiKey);
                showMessage('APIã‚­ãƒ¼ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ', 'success');
                refreshAllStreams();
            } else {
                showMessage('APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
            }
        }

        async function addChannel() {
            const input = document.getElementById('channelInput');
            const channelId = input.value.trim();
            
            if (!channelId) {
                showMessage('ãƒãƒ£ãƒ³ãƒãƒ«IDã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            if (!apiKey) {
                showMessage('ã¾ãšAPIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                const channelInfo = await getChannelInfo(channelId);
                if (channelInfo && !channels.find(c => c.id === channelInfo.id)) {
                    channels.push(channelInfo);
                    localStorage.setItem('youtube-channels', JSON.stringify(channels));
                    input.value = '';
                    loadChannels();
                    refreshAllStreams();
                    showMessage(`ãƒãƒ£ãƒ³ãƒãƒ« "${channelInfo.title}" ã‚’è¿½åŠ ã—ã¾ã—ãŸ`, 'success');
                } else if (channels.find(c => c.id === channelInfo.id)) {
                    showMessage('ã“ã®ãƒãƒ£ãƒ³ãƒãƒ«ã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™', 'error');
                }
            } catch (error) {
                showMessage('ãƒãƒ£ãƒ³ãƒãƒ«ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
            }
        }

        async function getChannelInfo(channelId) {
            // ãƒãƒ£ãƒ³ãƒãƒ«IDã‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‹ã‚’åˆ¤å®š
            const isChannelId = channelId.startsWith('UC') && channelId.length === 24;
            const endpoint = isChannelId 
                ? `https://www.googleapis.com/youtube/v3/channels?part=snippet&id=${channelId}&key=${apiKey}`
                : `https://www.googleapis.com/youtube/v3/channels?part=snippet&forUsername=${channelId}&key=${apiKey}`;

            const response = await fetch(endpoint);
            const data = await response.json();

            if (data.error) {
                throw new Error(data.error.message);
            }

            if (data.items && data.items.length > 0) {
                const channel = data.items[0];
                return {
                    id: channel.id,
                    title: channel.snippet.title,
                    thumbnail: channel.snippet.thumbnails.default.url
                };
            }
            throw new Error('ãƒãƒ£ãƒ³ãƒãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        }

        function removeChannel(channelId) {
            channels = channels.filter(c => c.id !== channelId);
            localStorage.setItem('youtube-channels', JSON.stringify(channels));
            delete liveStreams[channelId];
            loadChannels();
            updateStreamsDisplay();
        }

        function loadChannels() {
            const channelList = document.getElementById('channelList');
            channelList.innerHTML = '';

            channels.forEach(channel => {
                const div = document.createElement('div');
                div.className = 'channel-item';
                
                const isLive = liveStreams[channel.id] && liveStreams[channel.id].isLive;
                const statusClass = isLive ? 'live' : 'offline';
                const statusText = isLive ? 'LIVE' : 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³';

                div.innerHTML = `
                    <div class="channel-info">
                        <div class="channel-name">${channel.title}</div>
                        <div class="channel-id">${channel.id}</div>
                    </div>
                    <div>
                        <span class="status ${statusClass}">${statusText}</span>
                        <button class="btn btn-small btn-danger" onclick="removeChannel('${channel.id}')">å‰Šé™¤</button>
                    </div>
                `;
                channelList.appendChild(div);
            });
        }

        async function getLiveStream(channelId) {
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&eventType=live&type=video&key=${apiKey}`
                );
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message);
                }

                if (data.items && data.items.length > 0) {
                    const stream = data.items[0];
                    return {
                        videoId: stream.id.videoId,
                        title: stream.snippet.title,
                        isLive: true
                    };
                }
                return { isLive: false };
            } catch (error) {
                console.error('ãƒ©ã‚¤ãƒ–ã‚¹ãƒˆãƒªãƒ¼ãƒ å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                return { isLive: false, error: error.message };
            }
        }

        async function refreshAllStreams() {
            if (!apiKey) {
                showMessage('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }

            const promises = channels.map(async channel => {
                const stream = await getLiveStream(channel.id);
                liveStreams[channel.id] = stream;
            });

            await Promise.all(promises);
            loadChannels();
            updateStreamsDisplay();
        }

        function updateLayout() {
            const grid = document.getElementById('streamsGrid');
            const layout = document.getElementById('gridLayout').value;
            grid.className = `streams-grid ${layout}`;
        }

        function updateStreamsDisplay() {
            const grid = document.getElementById('streamsGrid');
            grid.innerHTML = '';

            channels.forEach(channel => {
                const container = document.createElement('div');
                container.className = 'stream-container';

                const stream = liveStreams[channel.id];
                
                container.innerHTML = `
                    <div class="stream-header">
                        <div class="stream-title">${channel.title}</div>
                        ${stream && stream.isLive ? '<span class="status live">LIVE</span>' : '<span class="status offline">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³</span>'}
                    </div>
                    ${createStreamContent(channel, stream)}
                `;

                grid.appendChild(container);
            });
        }

        function createStreamContent(channel, stream) {
            if (!stream) {
                return '<div class="loading"><div class="spinner"></div>èª­ã¿è¾¼ã¿ä¸­...</div>';
            }

            if (stream.error) {
                return `<div class="no-stream">ã‚¨ãƒ©ãƒ¼: ${stream.error}</div>`;
            }

            if (!stream.isLive) {
                return '<div class="no-stream">ç¾åœ¨ãƒ©ã‚¤ãƒ–é…ä¿¡ä¸­ã§ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
            }

            return `
                <iframe class="stream-frame" 
                        src="https://www.youtube.com/embed/${stream.videoId}?autoplay=1&mute=1" 
                        allowfullscreen>
                </iframe>
            `;
        }

        function showMessage(message, type) {
            const existingMessage = document.querySelector('.error-message, .success-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const div = document.createElement('div');
            div.className = type === 'success' ? 'success-message' : 'error-message';
            div.textContent = message;
            div.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
                padding: 15px 20px;
                border-radius: 12px;
                color: white;
                font-weight: 600;
                background: ${type === 'success' ? '#2ed573' : '#ff4757'};
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                animation: slideIn 0.3s ease;
            `;

            document.body.appendChild(div);

            setTimeout(() => {
                if (div.parentNode) {
                    div.remove();
                }
            }, 4000);
        }

        // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§ã®è¿½åŠ 
        document.getElementById('channelInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addChannel();
            }
        });

        document.getElementById('apiKey').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                saveApiKey();
            }
        });

        // å®šæœŸçš„ãªæ›´æ–°ï¼ˆ5åˆ†ãŠãï¼‰
        setInterval(refreshAllStreams, 5 * 60 * 1000);

        // ã‚¹ã‚¿ã‚¤ãƒ«è¿½åŠ 
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            .success-message {
                background: #2ed573 !important;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>